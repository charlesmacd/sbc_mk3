
*/


module host_register #(parameter width = 8) (
	input wire clock,
	input wire reset_n,
	input wire load_enable,
	input wire [width-1:0] d,
	output wire [width-1:0] q
	);
	
	genvar i;
	generate
	for(i = 0; i < width; i = i + 1)
	begin : storage
		DFFE ff (.clk(clock), .d(d[i]), .q(q[i]), .clrn(reset_n), .prn(1'b1), .ena(load_enable));
	end
	endgenerate
	
endmodule /* host_register */



/* Register file */
module host_register_block #(parameter count = 4, width = 8) (
	input wire host_cs_n,
	input wire host_wr_n,
	input wire reset_n,
	input wire [$clog2(count-1):0] host_address,
	input wire [width-1:0] host_data,
	output wire [count-1:0] external_enables,
	output wire [(count * width)-1:0] qout
	);

	wire [count-1:0] enables;
	
	decoder #(count) host_write_decoder (
		.select(host_address),
		.enable(host_cs_n),
		.y(enables)
		);
	
genvar i;

generate 
for(i = 0; i < count; i = i + 1)
begin : reg_block

	host_register #(width) reg_ele (
		.clock(host_wr_n),
		.load_enable(enables[i]),
		.reset_n(reset_n),
		.d(host_data),
		.q(qout[i * width +: width])
		);
end
endgenerate	

assign external_enables = enables;
	
endmodule /* host_register_block */
